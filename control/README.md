## About

garage-door-tools/control contains a simple application for
controlling a garage door opener with moderate security. It is similar
to but simpler than the
[oneid-garage-door](https://github.com/jimfenton/oneid-garage-door)
code which provides greater security but is somewhat harder to use and
depends on the [OneID](https://oneid.com) identity management product.

The application consists of two Python programs intended to run
as CGI applications from a web server such as Apache:

* garage.py - Displays a page with a button for the user to press in
order to operate (close or open) the garage door. Reads and displays
the current state of the door from the Raspberry.

* operate.py - Determines if the authenticated user is authorized to
open the door, and if so, directs the Raspberry Pi to activate a relay
to do so.  Logs the action in syslog. Also handles enrollment of new
users.

It also includes:

* GarageOpen.png and GarageClosed.png, images used to show the open
and closed state of the door on the opening screen. GarageClosed.png
is also used as an icon if the opening page is saved to the home
screen on an iPhone.

### Caution

This program potentially gives you the ability to open and close a
garage door from basically anywhere.  This represents a small but
non-zero risk to safety and personal property. For this reason, I
recommend connecting the Raspberry Pi to the network behind a
firewall, so that it is only accessible from the local network where
the user is more likely to be in proximity to the door when operating
it.

### Python Requirements

This application uses the [Raspberry Pi GPIO
daemon](https://github.com/jimfenton/raspberry-gpio-daemon) to
communicate with the GPIO port from the web server application.

## Installation

Install the Python programs in an executables directory in the web
server.  This might be under cgi-bin (with other web pages redirecting
there) or by enabling execution directly from the directory referenced
by the user.  This is probably not a good security practice in
general, but since a given Raspberry Pi processor is likely not to be
used for other things, might be reasonable here.

If you use SSL in conjunction with this application, which is
particularly recommended if it is accessible outside a closed network
recommended, you will need to obtain and install X.509 certificates
for the server. If SSL is not used, the shared secret key used to
authenticate the user's device is sent in the clear over the network.

Write access to the directory containing the authorized user list,
garage.cfg, is needed to add new authorized garage door operators.

## Operation and Administration

The garage door opener application maintains a list of authorized
garage door operators in the file garage.cfg, which is a JSON dump of
the authorized users' list.  It initially has an empty list of
authorized users.  To authorize a user, press and hold the Learn
button (see schematic) while that user presses the Open or Close
button in the application and the user will be authorized for future
use of the door. It then prompts for the name of the user or device
being authorized. This is not required but is included in activity
logs (in syslog) and helps identify who did what.

There is currently no mechanism to deauthorize a user; you need to
either edit garage.cfg or clear it and reauthorize all users.

The web page generated by garage.py includes Javascript that looks for
a value called "key" in HTML 5 local storage. If it is not found, it
generates a random value and stores it in local storage for future
use. This key, of course, is a shared secret and if made available to
an attacker will allow them to operate the door.

## Future work

Some ideas for enhancements:

* Establish a tier of administrative users who could authorize users
  who have tried and failed to open the garage door and de-authorize
  users when needed. This is probably not needed for the typical
  garage door, but might be useful in office situations, for example.

* Set dates and times for access to certain users. For example, you
  might want to authorize access by the gardener on Tuesdays between 8
  am and 5 pm, but not at other times.

## Change Log

### 0.1.0

* Initial version.
